# 设计模式和架构相关.

#### 什么是六大设计基本原则以及你的理解?你接触过哪些设计模式?在iOS开发中你都有哪些应用?
1. 单一职责原则,一个类只负责一件事,在UIView和CALayer关系中头很好的提现
2. 开闭原则:对修改关闭对扩展开发,一个类对他相应结构的修改需要隐藏,对他的成员变量需要谨慎考虑,避免反复修改,对其扩展可以开放.
3. 接口隔离原则:使用多个专门的协议而不是一个庞大臃肿的协议,iOS中tableView的两个代理方法就有很好的提现,一个用于数据源,一个用于事件
4. 依赖倒置原则:抽象不应该依赖于具体实现,具体实现可以依赖与抽象,如增删改查,暴露接口只需要只要抽象方法,具体实现可以有下层逻辑实现.但是下层逻辑的实现确依赖增删改查的逻辑.
5. 里式替换.父类可以被子类无缝替换,且原有功能不受影响,KVO的实现
6. 迪米特法则.一个对象尽可能减少对其他类中对象的了解,高内聚,低耦合.



#### 设计模式:
- 责任链模式?事件响应机制,实际场景,需求变更:ABC变换为CBA?当前类持有自己类相同的的属性成员变量,递归算法处理.
- 适配器模式?现有类需要不再更改原来的基础上实现新的功能?增加新类,以成员变量的方式持有被适配对象.在新类中创建新方法.调用老的类中方法前后插入自己的逻辑.
- 单例模式?注意事项:
	1. dispatch_once保证多线程创建一次,内部创建创建采用[super allocwithzone];,
	2. allocWithZone,
	3. copyWithZone.
- 工厂模式?:客户端可以直接消费产品,而不必关心具体实现.消除了客户端创建对象的责任.是客户端调用变简单.
直接创建对象进行key确定对象种类进行某些操作.比如手机的创建工厂,内部实现内具体创建各自类对象.有一个手机设备基类,实现打电话功能,子类各品牌手机,均实现重写相应功能.还可以遵循特定协议来实现其他的功能.
- 代理设计模式:oc中通过协议实现观察者模式
- 观察者模式:oc中通过通知以及kvo来实现观察者模式.

#### 你都了解哪些设计原则?以及你的理解?
你接触过哪些设计模式?在iOS开发中你都有哪些应用及理解?


#### 设计图片缓存框架?需要考虑哪些问题?
1. Mananger
2. 内存,磁盘,网络下载
3. 针对图片是否需要编解码,解压缩.
##### 问题:内存需要考虑哪些问题?磁盘需要考虑哪些问题,网络需要考虑哪些问题,读写需要考虑哪些问题,读写处理过程?
##### 针对内存如何分配磁盘如何分配和内存考虑有什么不同呢,以及怎么新增图片不占老的内存?针对图片的读写有哪些注意事项?
##### LRU算法,触发场景呢?
下次每次读写时机开始检查.
网络请求最大并发量,请求超时策略,请求优先级.
图片解码?采用什么方式来做呢?策略模式对不同格式进行解码.
哪个阶段进行磁盘解码?
磁盘读取之后,网络请求返回后.


#### 阅读时长统计框架?
记录器->记录管理者
页面式记录器,流式记录器,自定义记录器(多页面记录比如某一章节)

#### 记录管理者:
1. 记录缓存(程序杀死等场景的),
2. 磁盘储存(缓存记录记录到磁盘),
3. 上传器(本地数据上传server)
##### 为何要用不同类型的记录器?你的考虑是什么?
##### 记录某种原因丢失是怎么处理的呢?
定时写磁盘(每满50条),超过写磁盘
##### 上传时机怎么把控的?关于延时上传的具体场景都有哪些呢?
立即上传,延时上传,定时上传
前后台切换,无网到有网的变化.


#### 如何设计一个crash的第三方框架?
##### 内存等的设计,异常捕获,起死回生.
1. 运行时方法交换.
    exchangeMethod(a1,a2);
2. 获取所有异常捕捉,存储到内存中.
    NSSetUncaughtExceptionHandle()函数可以捕获所有异常.
        exception.init(),在当前对象创建时也会创建.
        句柄当存在异常时回将异常传递到上次对象层.
3. 在合适时机上传日志到服务器.
4. 起死回生.
    思路:首先理解事务的崩溃来自整个运行循环的崩溃,原因是任务卡住没有继续向下执行.
    获取当前runloopModes,循环遍历,将获取到的mode,再次运行起来.


#### 客户端整体架构是怎样的,上层可以依赖下层下层不能依赖上层?
独立于app的通用层:可以有时长统计的框架,崩溃统计,以及网络的第三方库
也就是说这些底层框架放到任何一个app中都能起到支撑作用独立于当前app.
通用业务层:比如自定的UI控件,特殊点击事件(增大按钮点击区域等),货币转化(服务器数据转化为显示货币数据),时间格式处理等
可以独立于app,整体的app对这些控件和功能都有需求.
中间层:起到协调和解耦作用.
业务层:业务A,业务B.可以直接就业务层进行更新.

#### 各个业务之前是如何进行解耦的?
1. OpenURL方式:DeepLink
2. 依赖注入:比如业务AC有业务关联,我们就可以在其中间层,通过弱引用找到C中的成员变量从而起到业务AC的解耦作用.
举例:在中间层中实现策略,比如让某个业务方将协议注册到中间层中,同时他需要实现中间层的代理方法来去返回给中间层一个具体的实例对象.






#### 客户端复杂页面架构设计?
	微博正文页代码源码?
1. 整体架构
	view和viewController,viewModel,Engine,Model
	视图层:view和viewController,
	业务逻辑层:viewModel
	数据层:engine,model.
2. 数据流
	1. 数据是如何传递的
	2. 网络数据 -> 业务数据 -> UI数据
3. 反向更新
	用户交互:网络刷新,主动,被动

#### 复杂页面的总结:
MVVM的思想.
view(viewController和viewWie视图层),model,viewModel
ReactNative数据流的思想.
可以看成多叉数,任何子节点没有权利做自己的变化更新,需要将变化更新的消息传递给根节点,由根节点自顶下更新各个节点.
UIView更新机制的思想,绘制原理.
RN中怎么跟UIView进行关联的?


#### AsyncDispalyKit关于预排版的设计思想.


# 第三方库
AFNetworking是否需要重点了解?
AFNetworking他的整体框架是怎样的?
AFURLSessionManager?AFHTTPSessionManager.


#### SDWebImage:整体框架是否了解?加载图片的流程?

#### RN需要讲下
RN中数据是如何传递的?


#### RAC,函数响应式编程?
基本原理:

```
信号RACSignal:一连串状态
订阅RACSubscriber:订阅信号,通知处理.
```

#### ASDK:AsyncDisplayKit:
基本原理:
ASDK在UIView之上进行了一层封装,把我们能在子线程处理的事件都放到后台线程中处理,从而减轻主线程的压力.

通过减轻主线程的压力将能挪到的子线程中进行的操作尽量挪到子线程进行

NSNode -> UIView -> UIKit
子线程         主线程
```
layout,rendering,UIKit objects
文本计算,布局计算
文本渲染,图片解码,图形绘制
对象创建,对象调整,对象销毁
```


#### 代码和sb谁更快?
纯代码是个多人协作开发,但是代码书写较慢
sb适合单人开发,拖控件快,协同开发容易出现git冲突.


#### FMDB对线程处理
FMDatabaseQueue,采用串行队列的形式.



#### podfile.lock里面包含个库中具体版本号.不应该添加所以这个文件不应该忽略.
->和~>的区别,前者直接指定版本,后者指定为版本区域[0.1.2, 0.2)

#### NSURLSession的最大并发数,默认设置ip地址的最大并发数为4.当用两个session进行数据请求时事共用一个最大并发数进行操作.

#### iOS内存警告,didReceiveMemoryWarining 会判断当前ViewController的view是否显示在window上，如果没有显示在window上，则didReceiveMemoryWarining 会自动将viewcontroller 的view以及其所有子view全部销毁，然后调用viewcontroller的viewdidunload方法。
在此方法内释放不需要使用的内存资源.



# 启动优化:
main之前
1. 加载可执行文件
	代码,方法对象内存.
2. 动态库加载
	rebase
	binding
	类的大小,文件多少,合并动态库.
3. 加载资源文件
main之后
	


二进制优化:可执行文件
虚拟内存出现.物理内存的分段管理虚拟内存,映射到物理内存.
程序访问虚拟地址.
cpu访问物理地址.
1. 安全
2. 内存更大化应用
二进制重排:
缺页异常:首先物理内存并没有完全加载程序的所有内存地址,当你在访问程序的时候需要加载对应的内存,如果从虚拟内存到物理内存中找,存在时直接加载物理内存,不存在时,需要从磁盘中查找对应内容重新写入到物理内存值.(很快)
页面置换:场景,当我们打开几个app时,后台切换时能直接访问内容而不需要进入启动页.多个app同时在后台时再次进入时却需要进入启动页重新加载程序?物理内存地址可以存在满的情况,此时是直接替换不活跃其他物理内存,存储新的打开app的物理内存.
什么时候出现大量缺页异常:app启动的时候,造成耗时.
怎么降低此时的缺页异常?让app的链接顺序按照启动的调用顺序进行排列.
创建.order文件进行二进制重排,将启动时刻的所有符号顺序按照顺序在.order文件排列这样子就能做到二进制启动的优化了.


1. 合并动态库和静态库
2. 二进制重排,只加载当前需要实现的内存.
3. 项目工程文件去除不必要的类,分类,方法.


如何获取当前项目的方法时间?
fishHock来hook objc_messageSend().
弊端:获取不到c++,block的方法执行



# 组件化:
#### iOS动态库和静态库的区别?
.a,.dylib,.framework文件的关系和区别,.a文件一般是静态库,.dylib是动态库,.framework是静态库或动态库的封装.
静态库,多个.o文件,但是可以通过链接器关键字控制(-force_load)只链接指定的.o文件.
动态库,将多个.o文件整个到一个.o文件,再通过dylib.本质区别就是动态库的mach.o文件是通过动态链接生成的.
使用use_frameworks生成的是动态的,

#### 动态链接和静态链接:
静态链接是编译时进行,动态链接是运行时进行.


#### 场景:自定义动态库framework中怎么引用第三方动态库,直接引用会报错?
首先自定义的库中引用第三方动态库,app的api包中是无法找到相关的第三方库的路径的,所以没办法直接引用
1. 通过脚本下载相应第三方库到app中.

#### cocopods的作用?
生成第三方库的动态库或静态库内容,获取路径.
生成相关的一些配置文件.
生成相应的脚本.
将底层的编译链接命令处理好了.


#### 青花瓷的https的截获原理?
中间人,添加信任证书,也能进行公私钥加解密.

#### url访问报证书错误的原因?
原因就是服务器证书是非ca权威机构证书导致的.

#### 上传日志怎么进行的?
通过iOS中NSSetUncaughtExectionHandle进行遗产捕捉,然后存储对应的崩溃信息到本地.然后再合适的时机长传到服务器.
